<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>üíó</title>
  <style>
    :root{
      --bg:#f2e3dd;
      --ink:#2f2a2a;
      --muted:rgba(47,42,42,.62);
      --accent:#c0182a;
      --safeL:max(16px, env(safe-area-inset-left));
      --safeR:max(16px, env(safe-area-inset-right));
      --safeT:max(14px, env(safe-area-inset-top));
      --safeB:max(14px, env(safe-area-inset-bottom));
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:#000;
      overflow:hidden;
    }

    /* ===== AUTO-HORIZONTAL (sin girar el celular) ===== */
    #rotator{
      position:fixed; inset:0;
      background: radial-gradient(1200px 800px at 60% 45%, rgba(255,255,255,.55), rgba(255,255,255,0)), var(--bg);
      transform-origin:center center;
    }
    body.portrait #rotator{
      width:100vh;
      height:100vw;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%) rotate(90deg);
    }

    .screen{
      position:absolute; inset:0;
      display:none;
      padding: calc(var(--safeT) + 12px) calc(var(--safeR) + 16px) calc(var(--safeB) + 12px) calc(var(--safeL) + 16px);
    }
    .screen.active{display:flex}

    /* ===== 1) Pantalla ‚Äúgira tel√©fono‚Äù (solo efecto 7s) ===== */
    #scrGate{
      background:#000;
      color:#fff;
      align-items:center;
      justify-content:center;
      gap:22px;
      z-index:50;
      transition:opacity .6s ease;
    }
    #scrGate.fade{opacity:0; pointer-events:none}
    .gateWrap{display:flex; align-items:center; gap:22px; user-select:none}
    .gatePhone{
      width:92px; height:164px;
      border:4px solid #fff;
      border-radius:18px;
      position:relative;
      opacity:.95;
      animation:phoneTurn 1.8s ease-in-out infinite;
    }
    .gatePhone:before{
      content:"";
      position:absolute;
      left:50%; top:12px;
      width:44px; height:6px;
      background:#fff;
      border-radius:6px;
      transform:translateX(-50%);
      opacity:.85;
    }
    @keyframes phoneTurn{
      0%{transform:rotate(0deg)}
      45%{transform:rotate(0deg)}
      75%{transform:rotate(90deg)}
      100%{transform:rotate(90deg)}
    }
    .gateText{
      font-weight:900;
      letter-spacing:.6px;
      text-transform:uppercase;
      line-height:1.05;
      font-size:44px;
    }
    .gateText small{
      display:block;
      font-size:18px;
      font-weight:700;
      opacity:.8;
      text-transform:none;
      letter-spacing:0;
      margin-top:10px;
    }
    .divider{width:3px; height:150px; background:#fff; opacity:.85}

    /* ===== 2) Pantalla coraz√≥n ===== */
    #scrHeart{
      align-items:center;
      justify-content:center;
      z-index:20;
    }
    .heartRow{
      display:flex;
      align-items:center;
      gap:22px;
      width:min(1100px, 92vw);
      user-select:none;
    }
    #heartBtn{
      border:0;
      background:transparent;
      cursor:pointer;
      padding:0;
      outline:none;
      display:grid;
      place-items:center;
      width:180px; height:180px;
    }
    #heartBtn svg{
      width:160px; height:160px;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.14));
      animation:pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:scale(1)}
      50%{transform:scale(1.07)}
    }
    .heartText h1{
      margin:0;
      color:var(--accent);
      font-weight:950;
      font-size:48px;
      line-height:1.02;
    }
    .heartText p{
      margin:12px 0 0;
      color:rgba(192,24,42,.9);
      font-weight:800;
      font-size:22px;
      position:relative;
      padding-bottom:10px;
    }
    .heartText p:after{
      content:"";
      position:absolute;
      left:0; bottom:0;
      width:320px; height:4px;
      background:rgba(192,24,42,.55);
      border-radius:999px;
    }

    /* ===== 3) Escena √°rbol ===== */
    #scrTree{
      align-items:stretch;
      justify-content:stretch;
      z-index:10;
    }
    .layout{
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: min(46vw,560px) 1fr;
      gap:18px;
      align-items:center;
    }
    #msg{
      white-space:pre-wrap;
      color:rgba(47,42,42,.82);
      font-weight:800;
      font-size:30px;
      line-height:1.22;
      user-select:none;
    }
    #canvasBox{
      position:relative;
      height: min(92vh, 640px);
      border-radius:18px;
      overflow:hidden;
    }
    #cv{
      position:absolute; inset:0;
      width:100%;
      height:100%;
      display:block;
    }
    /* suelo */
    #ground{
      position:absolute;
      left:6%;
      right:6%;
      bottom:18%;
      height:2px;
      background: rgba(47,42,42,.22);
      border-radius:999px;
      z-index:2;
      pointer-events:none;
    }
    #ground:after{
      content:"";
      position:absolute;
      left:0; right:0;
      top:6px;
      height:18px;
      background: radial-gradient(closest-side, rgba(47,42,42,.16), transparent 70%);
      filter: blur(2px);
    }

    @media (max-width:820px){
      .layout{grid-template-columns: 52vw 1fr}
      #msg{font-size:18px}
      .heartText h1{font-size:38px}
      .heartText p{font-size:18px}
    }
  </style>
</head>

<body>
  <div id="rotator">

    <!-- 1) Gate -->
    <section id="scrGate" class="screen active">
      <div class="gateWrap">
        <div class="gatePhone"></div>
        <div class="divider"></div>
        <div class="gateText">
          –ü–û–í–ï–†–ù–ò<br>–¢–ï–õ–ï–§–û–ù
          <small>–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç üòä</small>
        </div>
      </div>
    </section>

    <!-- 2) Heart -->
    <section id="scrHeart" class="screen">
      <div class="heartRow">
        <button id="heartBtn" aria-label="–ù–∞–∂–º–∏ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ">
          <svg viewBox="0 0 64 64" aria-hidden="true">
            <path fill="#d0243b"
              d="M32 56s-20-12.7-27.2-25.5C-1.8 18.1 6.2 6 18.6 8.4c5.2 1 9 5.1 10.6 8.4 1.6-3.3 5.4-7.4 10.6-8.4C52.2 6 60.2 18.1 59.2 30.5 52 43.3 32 56 32 56z"/>
            <path fill="rgba(255,255,255,.35)"
              d="M22 15c-5.8-1.1-11 4.5-9.8 11.5.5 3.2 2.6 6.6 5.9 10.2 1.1 1.2 3 .1 2.5-1.4-1.4-4.1-1.8-7.6-1.1-10.4.9-3.5 2.9-5.5 4.9-6.6 1.4-.8.9-3-1.4-3.3z"/>
          </svg>
        </button>

        <div class="heartText">
          <h1>–° –î–Ω—ë–º —Å–≤—è—Ç–æ–≥–æ<br>–í–∞–ª–µ–Ω—Ç–∏–Ω–∞!</h1>
          <p>–ù–∞–∂–º–∏ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ</p>
        </div>
      </div>
    </section>

    <!-- 3) Tree -->
    <section id="scrTree" class="screen">
      <div class="layout">
        <div id="msg"><span id="typed"></span></div>
        <div id="canvasBox">
          <canvas id="cv"></canvas>
          <div id="ground"></div>
        </div>
      </div>
    </section>

  </div>

<script>
(() => {
  // ====== TEXTOS ======
  const MESSAGE_RU =
`–ò–Ω–æ–≥–¥–∞ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–µ–ø–ª–µ–µ, –∫–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ —Ç–µ–±–µ.
–¢—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å –æ—Å–æ–±–µ–Ω–Ω—ã–º ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–≤–æ–∏–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º.

–ú–Ω–µ —Ö–æ—á–µ—Ç—Å—è –±–µ—Ä–µ—á—å —Ç–µ–±—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞–¥–æ–≤–∞—Ç—å, –¥–∞–∂–µ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏.
–Ø —Ü–µ–Ω—é –∫–∞–∂–¥—É—é –Ω–∞—à—É –º–∏–Ω—É—Ç—É, –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –∏ –∫–∞–∂–¥—É—é —É–ª—ã–±–∫—É.

–Ø –æ—á–µ–Ω—å —Å–∫—É—á–∞—é‚Ä¶ –∏ —è –ø—Ä–∞–≤–¥–∞ –æ—á–µ–Ω—å —Ç–µ–±—è –ª—é–±–ª—é.`;

  // ====== Screens ======
  const scrGate  = document.getElementById('scrGate');
  const scrHeart = document.getElementById('scrHeart');
  const scrTree  = document.getElementById('scrTree');
  const heartBtn = document.getElementById('heartBtn');
  const typedEl  = document.getElementById('typed');

  // ====== Portrait/landscape helper (auto horizontal) ======
  function setPortraitClass(){
    document.body.classList.toggle('portrait', window.innerHeight > window.innerWidth);
  }
  window.addEventListener('resize', setPortraitClass);
  setPortraitClass();

  // ====== Gate timing: 7 seconds ======
  setTimeout(() => {
    scrGate.classList.add('fade');
    setTimeout(() => {
      scrGate.classList.remove('active');
      scrHeart.classList.add('active');
    }, 650);
  }, 7000);

  // ====== Canvas ======
  const canvas = document.getElementById('cv');
  const ctx = canvas.getContext('2d');
  let W=0,H=0,DPR=1;

  function resizeCanvas(){
    const rect = canvas.getBoundingClientRect();
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    W = Math.floor(rect.width);
    H = Math.floor(rect.height);
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }

  // ====== Tree geometry ======
  const leafColors = ["#ff2f63","#ff4d6d","#ff6b8a","#ff8fb1","#ff3e6c","#ff5c7a"];
  const leaves = [];
  const wind = [];

  function heartImplicit(x,y){
    // Classic implicit heart: (x^2+y^2-1)^3 - x^2*y^3 <= 0
    return Math.pow(x*x + y*y - 1, 3) - (x*x)*Math.pow(y,3);
  }

  function buildHeartCanopy(){
    leaves.length = 0;
    const cx = W*0.56;       // centro copa
    const cy = H*0.26;
    const size = Math.min(W,H)*0.20;

    // much√≠simas hojas
    const COUNT = 1200;
    let tries = 0;
    while(leaves.length < 900 && tries < COUNT*40){
      tries++;
      const u = (Math.random()*2 - 1) * 1.2;
      const v = (Math.random()*2 - 1) * 1.2;
      if(heartImplicit(u,v) <= 0){
        let x = cx + u*size;
        let y = cy + (-v)*size;
        // forma m√°s ‚Äúcopa‚Äù
        y -= size*0.10;

        const r = 6 + Math.random()*9;
        leaves.push({x,y,r,rot:(Math.random()-0.5)*0.6,c:leafColors[(Math.random()*leafColors.length)|0]});
      }
    }
  }

  // ====== Drawing ======
  function clear(){
    ctx.clearRect(0,0,W,H);
    // fondo suave
    const g = ctx.createRadialGradient(W*0.35,H*0.35,20, W*0.55,H*0.55, Math.max(W,H));
    g.addColorStop(0,"rgba(255,255,255,.35)");
    g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);
  }

  function drawHeart(x,y,s,rot,color,alpha){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.globalAlpha = alpha;
    ctx.fillStyle = color;

    const k = s/18;
    ctx.beginPath();
    ctx.moveTo(0, 6*k);
    ctx.bezierCurveTo(0, 0, -10*k, -2*k, -10*k, -10*k);
    ctx.bezierCurveTo(-10*k, -18*k, 0, -18*k, 0, -8*k);
    ctx.bezierCurveTo(0, -18*k, 10*k, -18*k, 10*k, -10*k);
    ctx.bezierCurveTo(10*k, -2*k, 0, 0, 0, 6*k);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  // tronco ancho abajo + ramas
  function drawTrunkAndBranches(p){
    // p 0..1
    const baseX = W*0.56;
    const baseY = H*0.78;
    const topY  = H*0.34;
    const growY = baseY - (baseY - topY)*p;

    // tronco (taper)
    const topW = 16;
    const bottomW = 62; // m√°s ancho abajo
    const curve = 18;

    ctx.save();
    ctx.globalAlpha = 1;
    ctx.fillStyle = "rgba(45,30,30,.92)";

    // tronco parcial
    ctx.beginPath();
    ctx.moveTo(baseX - topW/2, growY);
    // si a√∫n no lleg√≥ abajo, limitamos base
    const yBottom = baseY;
    const yA = Math.min(yBottom, growY + (yBottom-growY));
    const t = p; // 0..1
    const wNowBottom = topW + (bottomW-topW)*t;

    ctx.lineTo(baseX - wNowBottom/2, yBottom - curve);
    ctx.quadraticCurveTo(baseX, yBottom + curve, baseX + wNowBottom/2, yBottom - curve);
    ctx.lineTo(baseX + topW/2, growY);
    ctx.closePath();
    ctx.fill();

    // ramas (crecen despu√©s)
    const bp = Math.max(0, Math.min(1, (p-0.35)/0.65));
    ctx.strokeStyle = "rgba(45,30,30,.90)";
    ctx.lineCap="round";
    ctx.lineJoin="round";

    function branch(x0,y0, x1,y1, x2,y2, x3,y3, w){
      ctx.lineWidth = w;
      ctx.beginPath();
      const steps = 28;
      for(let i=0;i<=steps;i++){
        const tt = (i/steps)*bp;
        const u = 1-tt;
        const x = u*u*u*x0 + 3*u*u*tt*x1 + 3*u*tt*tt*x2 + tt*tt*tt*x3;
        const y = u*u*u*y0 + 3*u*u*tt*y1 + 3*u*tt*tt*y2 + tt*tt*tt*y3;
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.stroke();
    }

    const tX = baseX;
    const tY = topY + 20;

    branch(tX,tY, tX-30,tY-20, tX-110,tY-55, tX-170,tY-110, 12);
    branch(tX,tY, tX+30,tY-20, tX+110,tY-55, tX+170,tY-110, 12);
    branch(tX-10,tY+10, tX-45,tY-30, tX-95,tY-45, tX-120,tY-85, 8);
    branch(tX+10,tY+10, tX+45,tY-30, tX+95,tY-45, tX+120,tY-85, 8);

    ctx.restore();
  }

  function drawCanopy(alpha, timeMs){
    // alpha 0..1
    const count = Math.floor(leaves.length * alpha);
    for(let i=0;i<count;i++){
      const L = leaves[i];
      const sway = Math.sin(timeMs*0.002 + i*0.03) * 0.35;
      drawHeart(L.x + sway, L.y, L.r*1.9, L.rot, L.c, 0.25 + alpha*0.75);
    }
  }

  // viento: corazones que caen y se mueven lateral
  function spawnWind(){
    const cx = W*0.56, cy = H*0.22;
    const spreadX = W*0.18, spreadY = H*0.10;
    const n = (Math.random()<0.6) ? 2 : 3;

    for(let i=0;i<n;i++){
      wind.push({
        x: cx + (Math.random()*2-1)*spreadX,
        y: cy + (Math.random()*2-1)*spreadY,
        vx: (0.6 + Math.random()*1.2),   // viento hacia la derecha
        vy: (0.9 + Math.random()*1.6),   // cae
        rot: Math.random()*Math.PI*2,
        vr: (Math.random()*2-1)*0.03,
        s: 9 + Math.random()*12,
        a: 1,
        c: leafColors[(Math.random()*leafColors.length)|0]
      });
    }
    if(wind.length > 240) wind.splice(0, wind.length-240);
  }

  function updateWind(){
    for(let i=wind.length-1;i>=0;i--){
      const P = wind[i];
      P.x += P.vx;
      P.y += P.vy;
      P.rot += P.vr;
      // oscilaci√≥n suave
      P.x += Math.sin(P.y*0.01) * 0.6;
      P.a -= 0.006;
      drawHeart(P.x, P.y, P.s, P.rot, P.c, Math.max(0,P.a));
      if(P.a<=0 || P.y>H+40 || P.x>W+80) wind.splice(i,1);
    }
  }

  // ====== Typing (palabra por palabra) ======
  function typeWords(){
    typedEl.textContent = "";
    const parts = MESSAGE_RU.split(/(\s+)/); // mantiene espacios
    let i = 0;
    const timer = setInterval(() => {
      typedEl.textContent += parts[i++] || "";
      if(i >= parts.length) clearInterval(timer);
    }, 95);
  }

  // ====== Animation loop ======
  let running=false;
  let t0=0;
  let typingStarted=false;
  let lastSpawn=0;

  function loop(now){
    if(!running) return;
    const t = now - t0;

    clear();

    // 1) tronco+ramas crecen (0..1)
    const pTree = Math.min(1, t/2200);
    drawTrunkAndBranches(pTree);

    // 2) canopy aparece despu√©s y CUBRE tronco+ramas
    const pLeaf = Math.min(1, Math.max(0, (t-1200)/2200));
    drawCanopy(pLeaf, t);

    // 3) viento despu√©s de hojas
    if(pLeaf > 0.25 && now - lastSpawn > 110){
      lastSpawn = now;
      spawnWind();
    }
    updateWind();

    // 4) texto palabra por palabra despu√©s de canopy
    if(!typingStarted && pLeaf > 0.70){
      typingStarted = true;
      setTimeout(typeWords, 250);
    }

    requestAnimationFrame(loop);
  }

  function startTreeScene(){
    scrHeart.classList.remove('active');
    scrTree.classList.add('active');

    // importante: esperar un poquito para que el layout horizontal ya est√© aplicado
    setTimeout(() => {
      resizeCanvas();
      buildHeartCanopy();
      wind.length = 0;
      typingStarted = false;
      typedEl.textContent = "";

      running = true;
      t0 = performance.now();
      requestAnimationFrame(loop);
    }, 60);
  }

  heartBtn.addEventListener('click', startTreeScene);

})();
</script>
</body>
</html>
